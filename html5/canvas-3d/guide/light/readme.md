# 光照

* 三维场景中实现不同类型得光照，以及其产生得效果；
* 光照使得场景更具层次感，使得三维场景更逼真；

```主要内容
明暗，阴影，不同类型的光：点光源光，平行光，散射光
物体表面反射光线的方式：漫反射和环境反射
编写代码实现光照效果

``` 

## 光照原理

* 反射光进入你得眼睛时，你才能看到物体并辨认出它得颜色；
* 光线照射到物体上，有两个重要现象
  + 根据 `光源` 和 `光线方向` ，物体不同表面得 `明暗程度` 不一致；
    - `明暗差异：` 给物体立体感
  + 根据 `光源` 和 `光线方向` ，物体 `向地面投下影子` ；
* 着色：根据光照条件重建 `物体各表面明暗不一的效果` 的过程；
* 阴影：物体向地面投下影子的现象；

## 光线的光源类型

* 平行光（太阳）
* 点光源（灯泡）
* 环境光（也是间接光（模拟真实世界中的非直射光

```

光的颜色：实际上已经包含光的强度信息；标准白光（1，1，1），两倍白光（2，2，2）
点光源会衰减，接近光源的地方强，较远的地方弱；

``` 

## 不同光的定义不同：

* 平行光：使用 `一个方向` ， `一种颜色` 来定义
* 点光源：指定光源的 `位置` 和 `颜色` ， `光线的方向` 将根据点光源的位置和被照射之处的位置计算出来
* 环境光：指定颜色即可，不用指定位置和方向，其强度是一致的
  + 被各种表面多次反射后形成的

## 物体表面如何反射光线

* 漫反射
* 环境反射

重点： 根据入射光和物体表面特征计算 `反射光的颜色`

## 反射类型

* 物体向哪个方向反射光，反射光是什么颜色：取决于 `入射光` 和 `物体表面的类型` ;
* 入射光的信息： `方向` 和 `颜色` ;
* 物体表面的信息： `表面的固有颜色` 和 `反射特性` ;

### 漫反射

* 是针对 `平行光` 和 `点光源` 而言的；
* 反射光在 `各个方向` 上都是 `均匀` 的；
* 物体表面像镜子一样光滑，光线就会以特定角度反射出去；
* 物体表面材质粗糙，反射光就会以不固定的角度反射出去；
* 漫反射是根据 `物体表面材质粗糙，反射光就会以不固定的角度反射出去` 而建立的理想反射模型；
* 反射光的颜色取决于入 `射光的颜色` , `表面的基底色` ， `入射光` ， `表面形成的入射角`

#### 漫反射中的概念

* 表面法线：
* 入射角： `入射光` 与 `表面法线` 形成的夹角
* 入射光：
* 反射光
* 光源
* 漫反射光强度受到入射角影响；

#### 漫反射公式：

* `入射光颜色` ： `平行光` 或者 `点光源` 的颜色
* `在颜色矢量上逐分量（R，G,B）进行的`
* 公式： `漫反射光的颜色` = `入射光颜色` *`表面基底色`* `cos(a)`

### 环境反射

* 针对环境光而言；
* 反射光的方向可以认为是 `入射光` 的 `反方向` ; 
* 环境反射光在任意处都相同；

#### 环境反射公式：

* 入射光颜色： `就是环境光的颜色` ；
* 公式： `环境反射光颜色` = `入射光颜色` * `表面基底色` ；

### 同时存在 `漫反射` 和 `环境反射`

* 将反射光相加，会得到物体最终被观察到的颜色：
* 公式： `表面的反射光颜色` = `漫反射光颜色` + `环境反射光颜色`

## 平行光下的漫反射

```

反射光颜色 = 入射光颜色 * 表面基地色 * cos
(1, 0, 0) = (1, 1, 1) * (1, 0, 0) * 1; 
=> 1 * 1 *1, 0 * 1 * 1，0 * 1 * 1
```

### 根据光线和表面的方向计算入射角

* 入射光方向和物体表面的朝向（法线方向）计算入射角；
* 计算两个矢量的点积，计算两个矢量的夹角的余弦值（ `cos` ）
* 公式： `cos` = `光线方向` * `法线方向`
 =》 反射光颜色 = 入射光颜色 * 表面基地色 *`光线方向`* `法线方向`

* 注意：
  + 光线方向矢量和表面法线矢量的长度必须是1； 将一个矢量的长度调整为一，同时保持方向不变的过程，为`归一化`；
  + 光线方向的反方向，与法线方向的夹角才是入射角；

### 法线：表面的朝向
- 法线/法向量： 物体表面的朝向，垂直于表面的方向；
- 法线有三个分量，（nx,ny,nz）表示从原点（0,0,0）指向（nx,ny,nz）的方向
- 涉及到表面和法向量时的问题：
  + 一个表面具有两个法向量（表面的`正面`，`背面`）
  + 平面的法向量唯一（`法向量表示的是方向，与位置无关，所以一个平面只有一个法向量`


## 环境光下的漫反射
- 公式： `环境反射光颜色` = `入射光颜色` * `表面基底色`
- 环境光，是有其他物体反射产生的，所以强度通常较弱，所以，白光（0.2,0.2，0.2）


## 运动物体的光照效果
- 平移变换不会改变法向量，因为平移不改变物体的方向；
- 旋转会改变法向量，因为改变了物体的方向；
- 缩放比例每个轴上都相同时，法向量不会变，不一致时，法向量会改变；


## 魔法矩阵：逆转矩阵
- 对顶点进行变换的矩阵称为模型矩阵；
- 计算变换之后的法向量；只要将`变换之前的法向量` *  `模型矩阵的逆转置矩阵`

