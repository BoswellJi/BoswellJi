## 概述

ECMAScript规格，使用内不得环境数据结构来存储变量。语言右不寻常得特性，通过对象使得环境用于全局变量访问，所谓得全局变量。一个全局对象通常用于创建，阅读，和改变全局变量。在全局作用域下，this指向它：

``` javascript
 var foo = 'hello';
 this.foo // read global variable
 'hello'

 this.bar = 'world'; // create global variable
 bar
     'world'
```

注意全局变量有原型。如果你想要列出所有它的属性（自身的以及继承的），你需要像列出所有属性键的getAllPropertyNames()这样的函数。

``` javascript
getAllPropertyNames(window).sort().slice(0, 5)['AnalyserNode', 'Array', 'ArrayBuffer', 'Attr', 'Audio']
```

javascript创始人Brendan Rich 认为全局对象，是最大遗憾之一。它对性能有负面影响，使得变量作用域的实现更加复杂，以及导致不能模块化代码。

## 跨平台注意事项

浏览器和nodejs有全局变量来引用全局对象。不幸的是，它们是不同的：

* 浏览器包括window, 被规范化作为DOM的一部分，但不是ECMAScript5的一部分。没一个框架（frame）或者window,都有一个全局对象。

* Nodejs包含global,它是nodejs特定变量。每个模块有自己的作用域，其中的this指向作用域变量的对象。因此this和global在内部是不同的。

在这两个平台上，this引用全局对象，但是只是在全局作用域中才会。在node.js中，几乎不会出现的案例。如果你想要在跨平台方法中访问global对象。你可以使用例如下面的模式：

```javascript
(function (glob) {
    // glob points to global object
}(typeof window !== 'undefined' ? window : global));
```
从现在开始，我使用window来引用global对象，但是在跨平台代码中，你应该使用前面的模式，用glob来代替。

## window使用案例

这章描述通过window来访问全局变量的案例。但是一般规则是：尽量避免那样做。

* 使用案例： 标记全局变量

前缀window是代码引用一个全局变量而不是本地变量的视觉提示：

```javascript
var foo = 123;
(function () {
    console.log(window.foo);  // 123
}());
```

但是这个让你的代码变得脆弱。一旦你将foo从全局作用域移动到另一个周围作用域它会停止工作。

```javascript
(function () {
    var foo = 123;
    console.log(window.foo);  // undefined
}());
```

因此，引用foo作为变量更好，而不是作为window的属性。如果你想要让foo是全局还是类似全局变量明确，你能添加例如g_的命名前缀：

```javascript
var g_foo = 123;
(function () {
    console.log(g_foo);
}());
```

* 使用案例：内置

我不喜欢通过window引用内置的全局变量。它们的名字众所周知，所以你从全局指针中获取很少。并且前缀window增加了凌乱：

```javascript
window.isNaN(...)  // no
isNaN(...)  // yes
```

* 使用案例：风格检查器

当你使用像是JSLint和JSHint这样的风格检查工具时，当你在引用一个没有定义在当前文件中的全局变量时使用window意味着你不会得到错误。但是，工具都提供了告诉它们关于这样的变量以及阻止这样的错误。（在它们的文档中搜索全局变量）。

* 使用案例：检查是否存在全局变量

它不是一个会频繁使用的案例，但是shims和polyfills尤其需要检查全局变量someVariable是否存在。在那个案例中，window帮助：

```javascript
if (window.someVariable) { ... }
```

这是执行这个检查的安全方式。下面的声明，如果someVariable没有被定义会抛出异常：

```javascript
// Don’t do this
if (someVariable) { ... }
```

有两种额外的方式，你可以通过window检查；它们粗略相等，但是更为明确：

```javascript
if (window.someVariable !== undefined) { ... }
if ('someVariable' in window) { ... }
```

通过typeof检查一个变量是否存在是一般方式：

```javascript
if (typeof someVariable !== 'undefined') { ... }
```

* 使用案例：在全局作用域创建事物

window让你添加事物到全局作用域中。（即使你在嵌套作用域中），并且它让你做事情如此自信：

```javascript
if (!window.someApiFunction) {
    window.someApiFunction = ...;
}
```

一般最好通过var添加事物到全局作用域，同时你在全局作用域中。但是，window提供一个有条件地增加的干净方案。